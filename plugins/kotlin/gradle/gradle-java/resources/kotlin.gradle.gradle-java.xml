<idea-plugin package="org.jetbrains.kotlin.idea.gradleJava" xmlns:xi="http://www.w3.org/2001/XInclude">
  <dependencies>
    <plugin id="org.jetbrains.plugins.gradle"/>
    <module name="kotlin.gradle.gradle-idea"/>
  </dependencies>

  <xi:include href="parcelize-dep-gradle-java.xml" xpointer="xpointer(/idea-plugin/*)"/>
  <xi:include href="scripting-dep-gradle-java.xml" xpointer="xpointer(/idea-plugin/*)"/>
  <xi:include href="noarg-dep-gradle-java.xml" xpointer="xpointer(/idea-plugin/*)"/>
  <xi:include href="sam-with-receiver-dep-gradle-java.xml" xpointer="xpointer(/idea-plugin/*)"/>
  <xi:include href="kapt-dep-gradle-java.xml" xpointer="xpointer(/idea-plugin/*)"/>
  <xi:include href="kotlinx-serialization-dep-gradle-java.xml" xpointer="xpointer(/idea-plugin/*)"/>

  <extensions defaultExtensionNs="org.jetbrains.plugins.gradle">
    <testTasksProvider implementation="org.jetbrains.kotlin.idea.gradleJava.run.KotlinMPPGradleTestTasksProvider"/>

    <frameworkSupport implementation="org.jetbrains.kotlin.idea.gradleJava.configuration.GradleKotlinMPPSourceSetsFrameworkSupportProvider"/>
    <frameworkSupport implementation="org.jetbrains.kotlin.idea.gradleJava.configuration.GradleKotlinJavaFrameworkSupportProvider"/>
    <frameworkSupport implementation="org.jetbrains.kotlin.idea.gradleJava.configuration.GradleKotlinJSBrowserFrameworkSupportProvider"/>
    <frameworkSupport implementation="org.jetbrains.kotlin.idea.gradleJava.configuration.GradleKotlinJSNodeFrameworkSupportProvider"/>

    <kotlinDslFrameworkSupport implementation="org.jetbrains.kotlin.idea.gradleJava.configuration.KotlinDslGradleKotlinMPPFrameworkSupportProvider"/>
    <kotlinDslFrameworkSupport implementation="org.jetbrains.kotlin.idea.gradleJava.configuration.KotlinDslGradleKotlinJavaFrameworkSupportProvider"/>
    <kotlinDslFrameworkSupport implementation="org.jetbrains.kotlin.idea.gradleJava.configuration.KotlinDslGradleKotlinJSBrowserFrameworkSupportProvider"/>
    <kotlinDslFrameworkSupport implementation="org.jetbrains.kotlin.idea.gradleJava.configuration.KotlinDslGradleKotlinJSNodeFrameworkSupportProvider"/>

    <pluginDescriptions implementation="org.jetbrains.kotlin.idea.gradleJava.configuration.KotlinGradlePluginDescription"/>

    <projectResolve implementation="org.jetbrains.kotlin.idea.gradle.scripting.importing.KotlinDslScriptModelResolver" order="first"/>
    <projectResolve implementation="org.jetbrains.kotlin.idea.gradle.commonizer.KotlinCommonizerModelResolver" order="first"/>
    <projectResolve implementation="org.jetbrains.kotlin.idea.gradle.cocoapods.KotlinCocoaPodsModelResolver" order="last"/>
    <projectResolve implementation="org.jetbrains.kotlin.idea.gradle.configuration.KotlinGradleProjectResolverExtension" order="first"/>
    <projectResolve implementation="org.jetbrains.kotlin.idea.gradle.configuration.KotlinGradleCoroutineDebugProjectResolver" order="last"/>
    <projectResolve implementation="org.jetbrains.kotlin.idea.gradle.testing.KotlinTestTasksResolver"/>
    <projectResolve implementation="org.jetbrains.kotlin.idea.gradle.configuration.KotlinMPPGradleProjectResolver"/>

    <orderEnumerationHandlerFactory implementation="org.jetbrains.kotlin.idea.gradle.execution.KotlinGradleOrderEnumerationHandler$Factory" order="first"/>

    <projectModelContributor implementation="org.jetbrains.kotlin.idea.gradle.scripting.importing.KotlinDslScriptModelContributor"/>

    <executionEnvironmentProvider implementation="org.jetbrains.kotlin.idea.gradleJava.execution.KotlinGradleAppEnvProvider"/>
  </extensions>

  <extensions defaultExtensionNs="com.intellij">
    <postStartupActivity implementation="org.jetbrains.kotlin.idea.gradle.scripting.SdkValidator"/>

    <externalProjectDataService implementation="org.jetbrains.kotlin.idea.gradle.configuration.KotlinGradleSourceSetDataService"/>
    <externalProjectDataService implementation="org.jetbrains.kotlin.idea.gradle.configuration.KotlinGradleProjectDataService"/>
    <externalProjectDataService implementation="org.jetbrains.kotlin.idea.gradle.configuration.KotlinGradleLibraryDataService"/>
    <externalProjectDataService implementation="org.jetbrains.kotlin.idea.gradle.configuration.KotlinTargetDataService"/>
    <externalProjectDataService implementation="org.jetbrains.kotlin.idea.gradle.configuration.KotlinOutputPathsDataService"/>
    <externalProjectDataService implementation="org.jetbrains.kotlin.idea.gradle.KotlinJavaMPPSourceSetDataService"/>
    <externalProjectDataService implementation="org.jetbrains.kotlin.idea.gradle.configuration.klib.KotlinNativeLibraryDataService"/>

    <externalSystemTaskNotificationListener implementation="org.jetbrains.kotlin.idea.gradle.scripting.importing.KotlinDslSyncListener"/>

    <editorNotificationProvider implementation="org.jetbrains.kotlin.idea.gradle.scripting.GradleScriptNotificationProvider"/>

    <runConfigurationProducer implementation="org.jetbrains.kotlin.idea.gradleJava.run.KotlinJvmTestClassGradleConfigurationProducer"/>
    <runConfigurationProducer implementation="org.jetbrains.kotlin.idea.gradleJava.run.KotlinMultiplatformJvmTestClassGradleConfigurationProducer"/>
    <runConfigurationProducer implementation="org.jetbrains.kotlin.idea.gradleJava.run.KotlinJvmTestMethodGradleConfigurationProducer"/>
    <runConfigurationProducer implementation="org.jetbrains.kotlin.idea.gradleJava.run.KotlinMultiplatformJvmTestMethodGradleConfigurationProducer"/>
    <runConfigurationProducer implementation="org.jetbrains.kotlin.idea.gradleJava.testing.js.KotlinMultiplatformJsTestClassGradleConfigurationProducer"/>
    <runConfigurationProducer implementation="org.jetbrains.kotlin.idea.gradleJava.testing.js.KotlinMultiplatformJsTestMethodGradleConfigurationProducer"/>
    <runConfigurationProducer implementation="org.jetbrains.kotlin.idea.gradleJava.testing.native.KotlinMultiplatformNativeTestClassGradleConfigurationProducer"/>
    <runConfigurationProducer implementation="org.jetbrains.kotlin.idea.gradleJava.testing.native.KotlinMultiplatformNativeTestMethodGradleConfigurationProducer"/>
    <runConfigurationProducer implementation="org.jetbrains.kotlin.idea.gradleJava.testing.common.KotlinMultiplatformCommonTestClassGradleConfigurationProducer"/>
    <runConfigurationProducer implementation="org.jetbrains.kotlin.idea.gradleJava.testing.common.KotlinMultiplatformCommonTestMethodGradleConfigurationProducer"/>

    <projectTaskRunner
            id="gradle.mpp"
            order="first, before gradle"
            implementation="org.jetbrains.kotlin.idea.gradleJava.execution.KotlinMPPGradleProjectTaskRunner"/>

    <registryKey
            key="kotlin.gradle.testing.enabled"
            description="Import Kotlin Gradle test tasks and process test output"
            defaultValue="true"
            restartRequired="false"/>
    <registryKey
            key="kotlin.mpp.tests.force.gradle"
            description="Run multi-platform tests with Gradle runner even if the platform runner is used by default.
              This setting currently affects only HMPP projects. You may need to delete existing test configurations for the change to take place."
            defaultValue="true"
            restartRequired="false"/>
  </extensions>

  <extensions defaultExtensionNs="org.jetbrains.kotlin">
    <projectConfigurator implementation="org.jetbrains.kotlin.idea.gradle.configuration.KotlinGradleModuleConfigurator"/>
    <projectConfigurator implementation="org.jetbrains.kotlin.idea.gradle.configuration.KotlinJsGradleModuleConfigurator"/>

    <gradleModelFacade implementation="org.jetbrains.kotlin.idea.gradle.inspections.DefaultGradleModelFacade"/>

    <scriptDefinitionContributor implementation="org.jetbrains.kotlin.idea.gradle.scripting.GradleScriptDefinitionsContributor" order="first"/>

    <scriptAdditionalIdeaDependenciesProvider implementation="org.jetbrains.kotlin.idea.gradle.scripting.GradleScriptAdditionalIdeaDependenciesProvider"/>
  </extensions>

  <extensions defaultExtensionNs="org.jetbrains.kotlin.idea">
    <gradleBuildScriptSupport implementation="org.jetbrains.kotlin.idea.gradleJava.configuration.KotlinGradleBuildScriptSupport"/>
  </extensions>
</idea-plugin>
